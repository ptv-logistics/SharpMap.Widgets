<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html>
<head>
    <title>Leaflet NonTiledLayer Example</title>
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
    <link href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" rel="stylesheet">
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html,
        body,
        #map {
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="map" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="./NonTiledLayer.js"></script>
    <script src="./NonTiledLayer.WMS.js"></script>
    <script src="./token.js"></script>
    <script>
        // initialize leaflet
        var map = new L.Map('map');

        // center Karlsruhe
        map.setView(new L.LatLng(51, 10), 9);

        // using the xmap WMS servlet
        var xMapUrl = 'https://api-eu-test.cloud.ptvgroup.com';
        var xMapAttribution = '<a href="http://www.ptvgroup.com">PTV<\/a>, HERE';

        // add the xServer layers
        // set the layer groups for default and sandbox
        var baseLayers = {
            "PTV classic": getLayers(xMapUrl + '/WMS/WMS', "", xMapAttribution),
            "PTV sandbox": getLayers(xMapUrl + '/WMS/WMS', "sandbox", xMapAttribution).addTo(map),
            "PTV silkysand": getLayers(xMapUrl + '/WMS/WMS', "silkysand", xMapAttribution)
        };

        L.control.layers(baseLayers, null).addTo(map);

        // add dymamic tile layer
        var myTileLayerUrl = 'SharpMapTilesHandler.ashx?x={x}&y={y}&z={z}',
	    myTileLayer = new L.TileLayer(myTileLayerUrl, {
	        maxZoom: 20, minZoom: 0, zIndex: 100
	    });
        map.addLayer(myTileLayer);

        // add dymamic tile layer
        var myOverlayLayer = new L.NonTiledLayer.WMS('SharpMapOverlayHandler.ashx', {
            opacity: 1.0,
            layers: '',
            format: 'image/png',
            transparent: true
        });
        map.addLayer(myOverlayLayer);

        // returns a layer group for xmap back- and foreground layers
        function getLayers(url, style, attribution) {
            var background = new L.TileLayer.WMS(url, {
                maxZoom: 19,
                minZoom: 0,
                opacity: 1.0,
                noWrap: true,
                layers: style? 'xmap-' + style + '-bg' : 'xmap-ajaxbg',
                format: 'image/png',
                transparent: false,
                attribution: attribution
            });

            var foreground = new L.NonTiledLayer.WMS(url + '?xtok=' + token, {
                zIndex: 0,
                opacity: 1.0,
                layers: style? 'xmap-' + style + '-fg' : 'xmap-ajaxfg',
                format: 'image/png',
                transparent: true,
                attribution: attribution
            });

            return L.layerGroup([background, foreground]);
        }

    </script>
</body>
</html>